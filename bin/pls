#!/usr/bin/env python3
from _rfstools import arg_parser, arg_processor
import logging


def get_instance():
  p = arg_parser.one_arg_parser(description='This command list a given remote folder, or returns a file name, if it is not a folder.')

  p.add('-p', '--prepend-dirname', action='store_true', help='Enables prepending dirnames (+ r:) to the output.')
  p.add('-d', '--directory', action='store_true', help='List directories themself, not their content. Not implemented yet.')
  p.add('-l', '--long-format', action='store_true', help='Use long listing format. Not implemented yet.')

  p.add('--sort', help="Sort by time/size. eg. --sort=time. Not implemented yet.")
  p.add('-r', '--reverse', help="Reverse order while sorting. Not implemented yet.")
  p.add('--time-style', help="Eather standard, fulliso or timestamp. Not implemented yet.")

  return arg_processor.init(p, "pls", ["prepend_dirname", "directory", "long_format", "sort", "reverse", "time_style"])

try:
  with get_instance() as ic:
    if ic.file.remote == False:
      raise ValueError("A given file must be remote.")

    ls = None
    if ic.prepend_dirname:
      ls = ic.connection.xls(ic.file.path)
    else:
      ls = ic.connection.ls(ic.file.path)

    for name in ls:
      print('r:' + name)

except Exception: 
  logging.exception("Fatal error. (returning 1)")
  exit(1)
 
logging.info("Finished succesfully. (returning 0)")
exit(0)
